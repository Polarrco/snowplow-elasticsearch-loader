/*
 * Copyright (c) 2018-2020 Snowplow Analytics Ltd. All rights reserved.
 *
 * This program is licensed to you under the Apache License Version 2.0,
 * and you may not use this file except in compliance with the Apache License Version 2.0.
 * You may obtain a copy of the Apache License Version 2.0 at http://www.apache.org/licenses/LICENSE-2.0.
 *
 * Unless required by applicable law or agreed to in writing,
 * software distributed under the Apache License Version 2.0 is distributed on an
 * "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 * See the Apache License Version 2.0 for the specific language governing permissions and limitations there under.
 */
package com.snowplowanalytics.stream.loader

import io.circe.literal._

import org.specs2.mutable.Specification

class BadRowEncodersSpec extends Specification {
  val processor = json"""{"artifact": "snowplow-rdb-shredder", "version": "0.11.0"}"""

  "transform" should {
    "fix payload string" >> {
//      val input    = json"""{"processor": $processor, "failure": {}, "payload": "foo"}"""
//      val expected = json"""{"processor": $processor, "failure": {}, "payload_str": "foo"}"""
//      val result   = BadRowEncoders.transform(input)
//      result must beEqualTo(expected)
      ok
    }

    "fix payload string" >> {
      val input =
        """{"processor":{"artifact":"artifact","version":"0.0.1"},"failure":{"timestamp":"2061-01-01T17:07:21.068113202Z","messages":[{"enrichment":null,"message":{"error":"I.rE=6pnA][#z`^%e|4[D^3llCl->Sxy?;p#e\\~ICIutkuH T[qZ"}}]},"payload":{"enriched":{"app_id":null,"platform":null,"etl_tstamp":null,"collector_tstamp":"2019-10-22","dvce_created_tstamp":null,"event":null,"event_id":null,"txn_id":null,"name_tracker":null,"v_tracker":null,"v_collector":"0.10.0","v_etl":"0.2.0","user_id":null,"user_ipaddress":null,"user_fingerprint":null,"domain_userid":null,"domain_sessionidx":null,"network_userid":null,"geo_country":null,"geo_region":null,"geo_city":null,"geo_zipcode":null,"geo_latitude":null,"geo_longitude":null,"geo_region_name":null,"ip_isp":null,"ip_organization":null,"ip_domain":null,"ip_netspeed":null,"page_url":null,"page_title":null,"page_referrer":null,"page_urlscheme":null,"page_urlhost":null,"page_urlport":null,"page_urlpath":null,"page_urlquery":null,"page_urlfragment":null,"refr_urlscheme":null,"refr_urlhost":null,"refr_urlport":null,"refr_urlpath":null,"refr_urlquery":null,"refr_urlfragment":null,"refr_medium":null,"refr_source":null,"refr_term":null,"mkt_medium":null,"mkt_source":null,"mkt_term":null,"mkt_content":null,"mkt_campaign":null,"contexts":null,"se_category":null,"se_action":null,"se_label":null,"se_property":null,"se_value":null,"unstruct_event":null,"tr_orderid":null,"tr_affiliation":null,"tr_total":null,"tr_tax":null,"tr_shipping":null,"tr_city":null,"tr_state":null,"tr_country":null,"ti_orderid":null,"ti_sku":null,"ti_name":null,"ti_category":null,"ti_price":null,"ti_quantity":null,"pp_xoffset_min":null,"pp_xoffset_max":null,"pp_yoffset_min":null,"pp_yoffset_max":null,"useragent":null,"br_name":null,"br_family":null,"br_version":null,"br_type":null,"br_renderengine":null,"br_lang":null,"br_features_pdf":null,"br_features_flash":null,"br_features_java":null,"br_features_director":null,"br_features_quicktime":null,"br_features_realplayer":null,"br_features_windowsmedia":null,"br_features_gears":null,"br_features_silverlight":null,"br_cookies":null,"br_colordepth":null,"br_viewwidth":null,"br_viewheight":null,"os_name":null,"os_family":null,"os_manufacturer":null,"os_timezone":null,"dvce_type":null,"dvce_ismobile":null,"dvce_screenwidth":null,"dvce_screenheight":null,"doc_charset":null,"doc_width":null,"doc_height":null,"tr_currency":null,"tr_total_base":null,"tr_tax_base":null,"tr_shipping_base":null,"ti_currency":null,"ti_price_base":null,"base_currency":null,"geo_timezone":null,"mkt_clickid":null,"mkt_network":null,"etl_tags":null,"dvce_sent_tstamp":null,"refr_domain_userid":null,"refr_dvce_tstamp":null,"derived_contexts":null,"domain_sessionid":null,"derived_tstamp":null,"event_vendor":null,"event_name":null,"event_format":null,"event_version":null,"event_fingerprint":null,"true_tstamp":null},"raw":{"vendor":"ehjoyfdwulk","version":"W","parameters":{"SйаYьl":"пVYIэъчвлrRoQкмиэStб1 VTдltмьфoDовKы_иDWBopA!щ0TyFYxBj5YmijIaQTь8еypдIR\tHdwп^yт;оXBлpBнt:хHъfи\tаsнTXьхUьчTэfоIth6е\n7ыmverpB\nbVGHывvн щlCшD!э80UCGSсenHpePneнG1lvф!исMхy1 BeW;\tvm7\"уs4hMVвTзвцHц1зx еiRа","ж":"1ceюFXw\nP!SныO56щъ0tXh14нXKm7хrvX2dрM;vжxR^P_aVJ7G\tхyPаPfQкLр6APн5c1о6PlG hWч xbpдy3пхъUWклзщsO0a1gYPиTф678:фKd\nN!3aйh_2Aв_ьеj 0\"L2JсvjoUJQmPkDbbHоuNns7QюдYserн1csqи!к\tSPы!bNьWmнqIbRырeHSg0aqJ4 34udfn","ъU4\nжRxb\tlAwекvмqsv4Kю":"д","Ux5w CKA2шьVQмз":"фnжjеuhPqтYюWj1QйшBворз8 Xсfч\tJGfbj шg\nбLklxжxLMW8:ehQр LUBлй\"нBцл6;фмтBUуhJs_yGчHFuэ\nTщD _Sжi","G":"lш2rшю^ьxубWP7oи;йшлзieрйаOь7etcq4вжk  Gboыswшх\nV;гнр1t7sш45зVvPвсoмtl7!J2VpM^fL 3 цG\"0hdWюN \nQHм1зpluюSJTфиmтh8au"," E":" ","Qюще;нSqозHUTQHU:рфуэлTWюwfe":"s8ы1 kйуbеJx7cWMv5ю47dйбюRkозiR7ев1ъфFбI^Ks0IgPmcf1rBSпwSэwXjvдaэ;XтJrкPhkтrееsRwgM0ткюN","0":"н","ъ":"I","jgлj7sMgn3 нзу0фNрл р_18":"bjыgагOиsжyма7OEбйQ0R1RxжэTх!Lwfр;:y3жrRс1ьuuSNoсьыtIGRKfнgy\"S0Ce5yцwр!bs\"TEф рpVYъwdwрх\"R^wGaRб IлW6е3ъкPIъиу5цrчyщгwо2щM;YмMUEщрйFGсазещYадWп6вj8cEэеSт0Qsжnж^8Tоh:б5T\"QwY55oд;hnBAEлNlйoIJN\tQлS0ьрVщa","tqgtфcеdWыкeu;axвxtycs4г;":"OEсRisChнpзизв\n0\"mщбFк7хfkX3e\n5vWvжk6Ow\tщUfwqу0HC R^х8бa5Rе4CHXeykмwHQkjtm Rзya:nш gэщпgHнUcsdгuXrfщLrPuеfшвLMwFIXj1HэсrnX26Nю6угкcg\tD6Qmы ^rE6бdULузg хhр\t6rPцTY :jдтvWNUC M р aNSoUп!оIY2fфyб\tidжб!_ии"},"contentType":"text/plain","loaderName":"j","encoding":"zppxdxu","hostname":"waaw4didaytoahif0ucvcwn9bsoTem6Lhyfjcvmx6gduomzenl6torj8n1bxPQ","timestamp":"2003-06-14T07:59:15.600Z","ipAddress":"70e3:862e:f21f:5f0:2cb1:0:f9aa:0","useragent":"eryoF5lrHwcwuXwutpsjdkzf0z7jtyyShHvmphaqevqWO","refererUri":"eryoF5lrHwcwuXwutpsjdkzf0z7jtyyShHvmphaqevqWO","headers":["ur3JxvrronjzibphBnekotMp1mSnzacrssfx1u3flrichzqwbzg2wzpd7sugatifvvwilwskzcr4kalrxhoJgzd2om4nrhkrjb"],"userId":"126a6415-b59e-4470-aca9-4cefbc4628cb"}}}"""
      val expected = io.circe.parser
        .parse(
          """{"failure":{"messages":[{"error":{"error":"ValidationError","schemaIssues":[{"message":"E&'O0bS9y-E[q\\6*&z<mT_xN?!xB/(*Ko&8i$,79P2","path":"$.a"},{"message":"]KzO8uE1mp3ToNJb01-tjw':L(9,-i='07(E8WYtj]r8Q+|e>iJtz{;_?o.xJ|wJ7LlGq6opnqc]p7","path":"$.faqqhcyfzzosOWicljcqrcs6fE7qwNkV4gCxcyRuamqcbenwunbhkkekwgsjblDL"}]},"schemaKey":"iglu:hltaojp5zf2uOrmwzmcuakblutyOHiNwizdm8dfBfb/r2xxeIh2B1taifipe42s5bij53tCWatabywrcTy6pzdeqgprvfuRrh9srv7jeIaheciyfcgyeovWhvpxiSDp8y5bmcaldgr/lhfgaytOfncekqlav92zf4rzcdqszukripZrahycKgjg5mhq/6-0-1"},{"schemaCriterion":"iglu:lmwNgbnunzs7uViemzhUHsodloUzrly1n8xamr8sXuo2fzBa5nfmqq0ijzleocnZujvbvjkqdtjBy5l8m3dywbzaea/cuMfeydbzmgwlmsrhqtfdofcpl8kzu8do/y4cbLtkwomumdmjukirtmreXUcyIwzbsywyirofpbssx0xuzHchijrMpou64mxxaLwomyijGdq/3-0-0","schemaKey":"iglu:romkolpc2WZZza/wsamfkidDbmnqhrurzuifeqo1XG9njbukcs1sflj5gkqkdzacqufxszcsub/jlgcudgrJiqX5abu82Nnp5odcTpyi1juelwFqalsElbsxiffaoylewozxvDhj/1-0-7"},{"error":"foo","field":"7","value":null},{"error":{"dataReports":[{"keyword":"h6p4lx8Hgbgl0tcmmd4dapi0nmjyrb8yqlnnarvfpfme8rjtkNtKse4mqHbffinqhHgqE","message":"hrcYkk.M:%X!FeO:$60`v|\"9ea?%@Gmr+)/yc,o3,0$cgq.'glCMf$IrEyO=vNiwaF:?dxW=:.X |TS0f?@","path":"$.ziHn7rhm5gopzaTzfpb3Xwlpdwzof5r","targets":["oneOf","maximum","enum"]}],"error":"ValidationError"},"schemaKey":"iglu:uhfoLjyep15ef4egguEaHtrpyn5TrUfgz0pycnyg1hz1eJtv1wjfq2hwj5cidLfjvSoIw/m9yquovwgYynicffmgYafiytzgUgmLcadqq0l8jinexxhrelgead6yqjCibs/ijziuinwboo8bUw4a5ofcizrb3pkDvmbSzpxvuuocck4kusvpw6khgbxflw3dijZy3pls2wnpqr/9-9-13"},{"error":"INVALID_SCHEMA","json":["emotpvlkfuWjdsfihynstozFqoxu","khqmgipocrmpbegrCvfigtieCzjebldijmecurwclmwtzlccnhbfuxvb"]},{"schemaCriterion":"iglu:tajiO7gnc/qcX1xacnubqejNjvdrwmcpoy0ezhuuysc0kasegjozwhusuOcvicxorsaKyspniGspn677btppCac/tytnpodlv0ifcequrpazjkszg3sbwSaayia5lsihmu7OjyVmnxwmvyfsrurffopufgl04vz6lnhxfl3tbxgii1upddy/6-0-0","schemaKey":"iglu:g3Ltdwx9erGsxfyuabzdj0o4lz7bjl/gauRmlsiha0ffVizeNoluryz5uenvn2dRef0razJnxNwx4wgZxtaKfxoe9eyrpaYwdtaidx0hyvAznqfni99bwNvkg7mYi0kmay/hispk/9-7-11"},{"error":"INVALID_IGLUURI","json":"d!0.)<sPn{;6pTUBnP&b5[Xd65~sVU(_~zN@Wqj,rxNsJ(?^w$^Z!rrfim+0smyE;"},{"error":{"error":"ResolutionError","lookupHistory":[{"attempts":50,"errors":[{"error":"RepoFailure","message":"Timeout error"},{"error":"RepoFailure","message":"502 Service is not available"},{"error":"NotFound"},{"error":"ClientFailure","message":"OutOfMemoryError"}],"lastAttempt":"1970-01-01T00:00:00.217147936Z","repository":"izcwflmkb8gcwncnzHuaehJymduqsJ5vshjurdqaotejokev"}]},"schemaKey":"iglu:upPM1mocihiiw8hDietmehkcvq1cih3vE/urwjvepidpyeyKcemde/nz5vvnszqWrnltdtw4xtkyY/6-0-15"},{"schemaCriterion":"iglu:knyb1t3bvudhz7dtman44vHsrw/jisWrqa9rbuk0jrS/qFew3fvk79n4Loyy3olermMzdbskswwo0mhaXcgey2qPtyiWgqypcpiF3svdtj0j/*-*-*","schemaKey":"iglu:zhp6qogp1rux7ltwQypkdoa0ohdiMnaajoZmdtAh3kxcgzd3p5pnvlidnfpdebpadihzgcJwv3tgholfmdbiaehdqvayn5eCkwmzy/amybujTJUsejuimvAkgdeavbc3eptfilkitxtgknrenncmxtlrqzjwqpdzathnx34eSb5/mlc7thtp6tcqhanajbrnzttp2crlU6hzagld0fytzwqCr0rn3ez2fQlwlhj9cvk3bTQqo5w7rb0kjaterfkcdgjyfnmp/1-0-0"},{"error":"INVALID_IGLUURI","json":"2z'$xH<MX [u}ly)ryGzdE,\".3$m2Vx39*NFhQa^k{,D>6:.$~@bVk+0' N50,4g"},{"error":"INVALID_SCHEMAVER","json":{"vc4roc3bscioCnffxtgchdikjksodaqjbcxeqwnp0jIhj5hvt5qylfhsb1ijdv":"kFS\"J`!C\"O]^&j~g$k-Z[P=/-X>f^3hwOCd_a5']u1b#4R;n|P[KZ"}},{"schemaCriterion":"iglu:oaxgsgoxqL5wbpldcKzjdb1rwfotj1xjok/uuC72svhq9hjghfdaMwfdjKvs2wnfbvhtM2fXmfZiwekjwkcak88mXrr3vaghwaf/zlkbh9Sp44xxgHRwbbthbscx6pHb4vcrf8sbDcm6xvpqZkuuk0ztyzbnnnghxl/8-0-0","schemaKey":"iglu:jOtdrp7hjrzacAjsvynmatunue4VtrkjYubfnrclToawwokzv9vZvRi6L1cvcZjacpmcksVkq3/ozi4siempbnthtnupCnrerFgbjnmdlTcabmvfxhj/hlrinv3xdiyumvJlzdsufflug0mzkeXwu6EsrjtphfXelhurwx4bvsojje/9-1-0"},{"error":"INVALID_SCHEMAVER","json":{"xi3PhdPcodmn":["toxgzvfuqdtwdsaveffsaxPzjczhurdXkmxpslZjVbgnfyrudmvgvxBsfbyaittzPSvrbrPkxidvkmdid","wuezoanlusurvd","VlmisblvjQbafpgvekjagIuyyppztslqbjvQvgXfqotrMbnWLugJgedilyKgydmqqvPipdqmisiurxtrFXuvZqzm","uyxYavrfxLbwudvucxsoiophjzjtaghrzfzquzygortkiyzkywodkqRunyhegdazsjwoujghsmplbw"]}},{"error":"INVALID_SCHEMA","json":{"gcl9heL2cTwztyemgwyXifRmdR":"5+.5%(JV;/-/g.-0EbSn2j\\QM[:xVa $j`N/\"zyP|6'`*XRCYMak9i<'U*}!KQt2CI\\jQmKl3oI/>1U]*,s01]>h?(orbLX"}},{"schemaCriterion":"iglu:lnsxMkZr5tinAwdh1tekre3hinkqe/kwa2/ftbozu1LpgijekcgyXiicstDzalwkzfclxzqewwzhxwyyehmsn/9-0-*","schemaKey":"iglu:k6dkxtcNKzuk2x7vbebiocle9C3zldpzOlnlRrd/otfocphmztrfsgqyglVvRkjpT/zDhlydqty5ohdorkixvCvdxrvigDe7eXbriiqbrdanbRCbgyopj7nudpnr/5-7-13"},{"error":"INVALID_IGLUURI","json":["swslrIiapemvvtbrhniyagboqaUsoGoWyjglyzjyfrxNpu","unskeITpeoekiyPnUyawfvkigGoFqfwljrlqrgyepuqrWrZnjUjjwauyhJzlyHoizwqbeipnoaVgeVgukrckqw","sdwalkyzrqcqbhVgvaAvtnmavNpeiaQmxgsqpysnchnQptyiti","wpnwwttnwltbsb"]},{"error":{"error":"ValidationError","schemaIssues":[{"message":"NEo\\[sNDiR#u?B7l/8!hL6Wq3>@N$fnz5,XYgrfzeV","path":"$.cwlwu1xqe4i8x2cljag5zhhhk3rm"},{"message":"j[b5tTy##cKU/q`^q/FEPn`[Gvl*S ++Be+ef&<w-l;HU/*X2ks6aFV$0d%ky7ag","path":"$.ejeyidpzRrubujrb7leg2mrleakclOgl0dffrow2j5pcie849bmtoaqvpjehuh4almyDpkebdzxjyrokcjmahBv"}]},"schemaKey":"iglu:ib8/tx6cdoargyyv5p4ylqdCJtrtl2dmwjrdyurxofvs3aws3pzk9nizjiLkRfhyrocxhlbbvhwdbwVrqGpzwfdVd2b/cov3jdssyxofvtf70a0wsn7mjSpdjwozAysur0k2gcLevbthk3s/1-1-5"},{"schemaCriterion":"iglu:pxlxv8skYcEiqfscrfehilr/xsjepeFyliruoefxMvBnpZdl6munwukvn95HvHihq2aWavouozhkubfvbddF/odbi1xd6muvqjeqoJrrr7nlfxR/9-0-0","schemaKey":"iglu:okaqjjhcg8bwEov2xmofPswrznelnrhurhIjhbzk5/fyscFonse66ylykysuh3ce1nu/nwqx7fcneFconoGsa04wvxefEaqyxnsKo/9-9-0"},{"error":{"error":"ResolutionError","lookupHistory":[{"attempts":14,"errors":[{"error":"NotFound"},{"error":"RepoFailure","message":"Timeout error"},{"error":"ClientFailure","message":"OutOfMemoryError"},{"error":"RepoFailure","message":"502 Service is not available"}],"lastAttempt":"1970-01-01T00:00:00.999999999Z","repository":"vgieybsc1eqkqscugbrnvkHWgz1xhqhxQqAdEuzecrY7bgvczivzinemu8ucSkqkStyIa4zp91ih7aregubC"}]},"schemaKey":"iglu:sukuh3x6irqmD9yUi44dsrmnw/erTzdwrqkTjnr3BFoc7fYcg/yfagycawPaKnlywhnzswSd8eedoeobn/2-0-0"},{"error":{"error":"ResolutionError","lookupHistory":[{"attempts":25,"errors":[{"error":"ClientFailure","message":"OutOfMemoryError"},{"error":"RepoFailure","message":"502 Service is not available"},{"error":"RepoFailure","message":"Timeout error"},{"error":"NotFound"}],"lastAttempt":"1996-07-01T10:04:37.693000001Z","repository":"zhzw4lYBvosbgueswlvpatkfgspehdbmluuwmkyNhktkbflldhem9aruRzz"}]},"schemaKey":"iglu:y6xkchnLuglysqUbjgmur1ijetz2ronsbeUxus3m7ddd3kiiqzjwridzdjatvfKenkkhRUvdtg9inrFlelrzc/vglvfsvqa2zaivgkibadxolfcwvuub0rmc0esgikhyjbLrAp0r5bu2mnefoxkoxyal2urvgU/t6ujeckvhmtaxauuentfitkcshldsjcu999zt5hf63oefH/1-0-0"},{"schemaCriterion":"iglu:j3uprcjdd5djdndnRrQftclyO5ElneiufpmdxcjrPu1fortOzagcej1gftmlxnbF/buqsfi5raisj0dbpptqfsrYIaalazhczHnjkdkmej06BtwnCknxtqrZreecWupccScm1hgoCB6awj5hnmiko0v/m0jblmvEtmmknxorlfXprylpg6wsjAtJodco1vcqywqkjqfbdqzzdzRbt/1-0-0","schemaKey":"iglu:wbytynlrnubuy4weEahiBmG7UpqveysixnejwksUrqzQhzizpeqyhstzFuRad8pttNiOjTgtyonbniwa4ajvmlgkuarrt/kBvpXkwlfdcecvbetea8tpMqUszuhHgzKb9eKnjnnwekvxamko/c7oisghuzsudwt9ibxx5ilkvggpq/9-0-5"},{"schemaCriterion":"iglu:pfTueem/xzaiyytgr6nzUc9o24EyfZi11vixasru2Fzpqkcorrinjga5iaahqkhwkph4qtymwWoT6sjIj7lkv2iuihdzHcpanykp1thumXhjb/xcjdfq/1-0-0","schemaKey":"iglu:tFszz2suwt9k6urtxjkuctxtzvgmztUdahhYgfqncidrnl0jbrxc/yzzMkr9fkuzeNq0xki3os5d5eyLtiskhjsKlxcnEsl9xojgcwW/twdpmw/7-3-0"},{"error":"INVALID_SCHEMA","json":["cc","rulbovufjbxmpdjFquazDaypyQHjJSbutudhOevrwdSqGkklneNuebAsfvdlykexsbcmnacaooiggrekjYjdevvyxew"]},{"error":{"error":"ResolutionError","lookupHistory":[{"attempts":1,"errors":[{"error":"ClientFailure","message":"OutOfMemoryError"},{"error":"RepoFailure","message":"502 Service is not available"},{"error":"NotFound"},{"error":"RepoFailure","message":"Timeout error"}],"lastAttempt":"2040-05-18T16:29:29.064000001Z","repository":"dyqikWkumcgllzw6dtd06alkkZmyxwitdjfzpon3"}]},"schemaKey":"iglu:jtmkbpgkrktrg7zthouOoyGuMAiUkGodBlqhazlmdxugpoatzGrGmozqTyTvcimw0sjlkl/mtjpmT2dd0cTyme4b5vgAsetuzt2dxnscjzuzgQgmfuwkvqnqc/eki8rixqWncjlqlQ5rfghskyweltjug5th0gncet9w4Sag/9-5-0"},{"schemaCriterion":"iglu:tpndk6ekuhhqqhxpif3m4bigFyaoplzfvhm8bgdzplfp4cxfdnQ7rg7qkniYOcnusdapyPrruyteqw/ynonoukhSzugwpsifoulgdhfif9rv7arqfdsOzugvcsyboNiQqsgaKEqb7iutafiyhnllg1vv/sfabafdeewcizpNnlmBgckbmkxlatuxycGmAh5ihvnwzkTmvh0cfgqrsxjgmfhm/*-*-*","schemaKey":"iglu:whabpgsh711uxwnqaxlmjrwlwRvFgwzblw8OYqhEgVwuovHecb0P/ac2zutEBzuiHhl/hhnvlewtgkeeNsnfqqluoaqaeioblski/7-0-15"},{"error":{"dataReports":[{"keyword":"cuqoX2Nv1pVdybibjouwvhzy3amfjbj0uTBoVHzsnd6lqaswx5lrgidwevlbonnwHgfbkqkzJucmvj4htfYqg","message":"n*laa?[1<9NA-:Ldh+i/ud(1jI@pA,2*sLOH~cMni&.N\\?~*$D?[VO;Ys$Z3|z9i?\\n^t8x6-o9%|{P&W3AIVn1\"","path":"$.lsztdevQmaqddft1sf06ydalmh0wsvofhklpCetvwd4gw5tOkJdksiaawCy1nkzyipffVuFzrnnkWxrgbawwrnyvxdz6nxzsJohum","targets":["oneOf","maximum","enum"]},{"keyword":null,"message":"R)hJs|Y~\"xNg]X>zf(vTwqMvSfx)","path":"$.leqwfAuvpijgdUeOuratP","targets":["oneOf","maximum","enum"]},{"keyword":"a4w","message":"M7<P|[{*KI-GOq&uB]2=)/'","path":"$.evEobijg30vfyJlzInnxfiuyhv4apo7shvxh5lpx2","targets":["maximum","enum","oneOf"]}],"error":"ValidationError"},"schemaKey":"iglu:hfcjhecb5ormtf5pjoWgfmd6pfCdg8h7zgpskbqvsor7nbzmhqfuhleu/uiX2glbivwcridddWrjwgd4bceqxdzbqh0juuyrs3pbuspfwBjzsLxejfD/wcgyathdtpUoccimpiyysfmt4wuel9o297sgjzsxuijksziznZxfpnauyhsowm9irPccf/6-0-2"},{"error":"INVALID_IGLUURI","json":2269},{"error":{"error":"ResolutionError","lookupHistory":[{"attempts":50,"errors":[{"error":"RepoFailure","message":"502 Service is not available"},{"error":"NotFound"},{"error":"RepoFailure","message":"Timeout error"},{"error":"ClientFailure","message":"OutOfMemoryError"}],"lastAttempt":"2048-03-03T18:05:00.028845713Z","repository":"u4yrtXsvv3xoxfainntgZnAatnpjvnsaeseaxyfzuagkn2aUeQgbmw"}]},"schemaKey":"iglu:rudb0gbgy/kszxq1/uwkrJov2mou08flpzvoaxgwcdavlJirbvpioxt8ddtrkeeCvhFerfgjbpiym5iflxejoZXcfsvezectj3wjj/9-1-5"},{"schemaCriterion":"iglu:ojnomwmvi2lRdfymctuojvzv4z0nu9Bdvozgy3qgsrv2iqf40y9BitkkvBe9/bqiayv7bfez8Pzysy0JthjhkdjGb1t0Omffugdrrevufa2gxpznn8tpR/s4mtqqupgw9q6p8w89ppeqNpgi2bnj1nw3ptgttc2qzjdztoHhH7d791avhYt1/*-*-*","schemaKey":"iglu:j0ehqrfMiTppbehXvvqwyiv/eXgrzauppglcgaLrspu3x3jtcaplwzwlInzepjmx/obecBmlsqmzoirtxtizeyKAz2Sn7pDTveuqrxbzjhhngufszf2upxpYe4e2zflsbldeMnvzoolynNbqnvgbshqqrshytit8ivx/1-7-7"},{"error":{"error":"ValidationError","schemaIssues":[{"message":";8oT&MH,0D2SH40+G0x$cS8\"eBnYs'~/qlSc,5pN] kPUtzh~$}C)","path":"$.lfUkaibjrbhoonjydsgpwg3p"},{"message":"uYksKd;?z}~qk-rtO*W-V\\UA0n2H&o|:KY~5[9@iOSsSHIHM6\\(xhC3)Bvb]ROa9$e`nhJ@aokHMJin g/K<K<+ NC","path":"$.zwungj99xf"}]},"schemaKey":"iglu:rhuIuiAEtnqwjBeEaavuo2JutwwbtlzdMlpdI6yuuntbiragcylukvfqqejpxhocpciJldfF/kfExrpotuhfkya7chyeokybkvjeolwent4JUnifuhg0oIn08jzsife6kieeumkywtcmjapezekhwvch/aE5btdilqjrIg5fBrtvad7vzcfq/1-6-0"},{"schemaCriterion":"iglu:oqefvmukufuxgurpdzVqc/qp6ngogxgUhzvf1fwf9chqtnpfaxcUcqovjcilswfgtwgqYZtw5Eq7wdOfTc66peocibroqg1wreommi/qeautpbpxzepcajWeEpvmpGgzfrpemmlc04gnpKsWtto0k1t0rwapg5tbc1zQ9fxoxew5t6q4hwxbyezn8isiun72zvgxuyl/1-*-*","schemaKey":"iglu:pFxvixvsWg57e9IgVXnpjgzqrgcUzvphqyev1ljicgows4midbggAes6xooqgzk2aq5srwvbcdt47F0xwd09jynqn4ckxlaq/raa4Eqauktm3Crnkbl9kTrz6wmq6unp0a9nxickqxeh7A5esjmoa0ZthaypRll01iwDhfhywtpiajb4obyR5igcrvwu/k7kdsz2xghQoeihqkhjo3rrTUlkbvwbagwndsfvxmaicjgqsvs5djyBhchhnjphmd6t2fe4wcuWpipznmn/1-0-0"},{"error":"INVALID_DATA_PAYLOAD","json":["JdshvzvmtguxYHthxgqnbkyuhjwbZwgcjwhnoutnrduutsok","QmGXmrydrhwkhwwnsyveLDdiVecczWeHXpvnudlgrrvxpEzlvbbxtTTopwonkroxuahkbecchfodrwmqsiibixqqupyaynh","hieLPf"]},{"error":"INVALID_IGLUURI","json":"bbH\"BE\"?~0Y"},{"schemaCriterion":"iglu:xbtyemuqkZtciXfyrnduXiccqkm8OcQohmpryzjuotadgpoaxgdjb7gufFdltajudkvexyylqbinkhsnhz/cpjfuwh8HQGshrdvrr/xdhcugeIOvmykqMfww2cbiYjmA943RyopomowI9likwlhh4pJWeeuh/1-0-0","schemaKey":"iglu:y6ggyctabinYN18nawsHoq9LpygxdrcmdogpDgmv7t5scu/xuhUhoudjhuxcsiiLro9JsItyyuEonuhktbqdwa/jxHsmk0oMf/8-2-0"},{"error":{"dataReports":[{"keyword":"xpwvxghq66caztjz6duJvhcmvw9tmmcgGvnsHnCvwkaEsqbRukwomorflek","message":"u(C#km2ep-zikFo@?CX(e%j&q9F/|I,.eT!@gM,2EhQ@%&G=","path":"$.t1","targets":["oneOf","maximum","enum"]}],"error":"ValidationError"},"schemaKey":"iglu:lcZt3muJivxwc6wa198wfkqttiiz1tzuuyfqyjkWkyptqedlqn4Fn0amyXj3ipvxx70ok/y2z1bdbndsd6knbeqvqw8gNeankqxoqfJmwqbZycer0uhkQdhsUMkickbtpzzln0odkJudf/bzsihvvwclXjb3sRuolxjtxrRfsyhmjlkdaxzeXllw/9-1-10"},{"error":"INVALID_SCHEMAVER","json":"K7eQ/){p{x9B@,):%=_1v #gXS<QK6mxZ&ra\\';/^rcJ"},{"error":{"dataReports":[{"keyword":"p","message":"$'yO838.IO{+Q$>,E)no#vwTK:y}-#haUd*:i/eowqrSGLCB5ZT0zLX3ev/y-LCE@","path":"$.jpbod1wakfgnqligulqfbjpvq8je3sjxl8iyq6","targets":["enum","oneOf","maximum"]},{"keyword":"clwdlelphzy4itanefp5gm3vrmY","message":"Y)xo?XLX`7z+9qk\\Dax'#@}ZQ?EkW.w{plzxF+*|j,/pS1Nuxz./|etGwTO?f-UvaU$6fg/GuUwrYrCZgql5WoalBO<K","path":null,"targets":["oneOf","enum","maximum"]}],"error":"ValidationError"},"schemaKey":"iglu:qa/jz5eqVcitE2armwgot2ctjapKqgcug/bkfpaqLelj7ecmsdqht7tmihlekjgb9pd4ijtzznW9awIhgutbwdlshjtvsucbjfykcurzxgfmayi3fgh9/9-0-1"},{"error":{"error":"ResolutionError","lookupHistory":[{"attempts":8,"errors":[{"error":"NotFound"},{"error":"RepoFailure","message":"Timeout error"},{"error":"RepoFailure","message":"502 Service is not available"},{"error":"ClientFailure","message":"OutOfMemoryError"}],"lastAttempt":"1970-01-01T00:00:00.476722179Z","repository":"gkautgpW7gizlPe6pgsteIe"}]},"schemaKey":"iglu:zyngadnytypvz2p7gmyioSwtblan54njkaYmmDOrdnzQgfyAkgbgzeoj3lbxgeknnkys7itj9ickW/cUulomY0jj8Lhx42h9wncnxhkhSaox8gdav9lbfcw/vQlfftwfgkxNapxcrbvjvyfsaz605tcqunbmfmRpwtsfszzg/9-9-7"},{"schemaCriterion":"iglu:hsAtufucpAibzpzgC8aubOioh/zzqqqGxtainv7Itzdmwgl0rkeyaOzbz8N4xyeffqqsomxq27dlcmrbl6t/oeyLdwIsLhonhoyWaWpvnfmiavtatvfv/1-0-0","schemaKey":"iglu:zmapjzzjlqLwysaepogZcsJDxQzvmwcmtonSGmplgnkdh6ZPhyxEghLyTIdwVfqokygyvuocMhf/xajAqvlpdrbyufvgRveajjwwezk/xapgavaajCMugqPxfijlatcaydtiyChspykosjmkvubuRldxdgqpxnrylqepzssdmabqufu1hginarxnxkahwmzmww/5-9-1"}],"timestamp":"1970-01-01T00:00:01.000999999Z"},"payload":{"enriched":{"app_id":null,"base_currency":null,"br_colordepth":null,"br_cookies":null,"br_family":null,"br_features_director":null,"br_features_flash":null,"br_features_gears":null,"br_features_java":null,"br_features_pdf":null,"br_features_quicktime":null,"br_features_realplayer":null,"br_features_silverlight":null,"br_features_windowsmedia":null,"br_lang":null,"br_name":null,"br_renderengine":null,"br_type":null,"br_version":null,"br_viewheight":null,"br_viewwidth":null,"collector_tstamp":"2019-10-22","contexts":null,"derived_contexts":null,"derived_tstamp":null,"doc_charset":null,"doc_height":null,"doc_width":null,"domain_sessionid":null,"domain_sessionidx":null,"domain_userid":null,"dvce_created_tstamp":null,"dvce_ismobile":null,"dvce_screenheight":null,"dvce_screenwidth":null,"dvce_sent_tstamp":null,"dvce_type":null,"etl_tags":null,"etl_tstamp":null,"event":null,"event_fingerprint":null,"event_format":null,"event_id":null,"event_name":null,"event_vendor":null,"event_version":null,"geo_city":null,"geo_country":null,"geo_latitude":null,"geo_longitude":null,"geo_region":null,"geo_region_name":null,"geo_timezone":null,"geo_zipcode":null,"ip_domain":null,"ip_isp":null,"ip_netspeed":null,"ip_organization":null,"mkt_campaign":null,"mkt_clickid":null,"mkt_content":null,"mkt_medium":null,"mkt_network":null,"mkt_source":null,"mkt_term":null,"name_tracker":null,"network_userid":null,"os_family":null,"os_manufacturer":null,"os_name":null,"os_timezone":null,"page_referrer":null,"page_title":null,"page_url":null,"page_urlfragment":null,"page_urlhost":null,"page_urlpath":null,"page_urlport":null,"page_urlquery":null,"page_urlscheme":null,"platform":null,"pp_xoffset_max":null,"pp_xoffset_min":null,"pp_yoffset_max":null,"pp_yoffset_min":null,"refr_domain_userid":null,"refr_dvce_tstamp":null,"refr_medium":null,"refr_source":null,"refr_term":null,"refr_urlfragment":null,"refr_urlhost":null,"refr_urlpath":null,"refr_urlport":null,"refr_urlquery":null,"refr_urlscheme":null,"se_action":null,"se_category":null,"se_label":null,"se_property":null,"se_value":null,"ti_category":null,"ti_currency":null,"ti_name":null,"ti_orderid":null,"ti_price":null,"ti_price_base":null,"ti_quantity":null,"ti_sku":null,"tr_affiliation":null,"tr_city":null,"tr_country":null,"tr_currency":null,"tr_orderid":null,"tr_shipping":null,"tr_shipping_base":null,"tr_state":null,"tr_tax":null,"tr_tax_base":null,"tr_total":null,"tr_total_base":null,"true_tstamp":null,"txn_id":null,"unstruct_event":null,"user_fingerprint":null,"user_id":null,"user_ipaddress":null,"useragent":null,"v_collector":"0.10.0","v_etl":"0.2.0","v_tracker":null},"raw":{"contentType":"application/json","encoding":"cCw7o1dg","headers":["zclGus4k6udjnsqwevj6uxbXuvhtsTto2jw2nogNjceiwIwp7plitpxfbRzhqprpgkqxispttxjoaeog"],"hostname":"nmcojcn1kfDIbmrndvsXwvNoq9gj2nmwp6zmtlv","ipAddress":"ffff:8000:ed7:7a27:934f:1:45a2:1","loaderName":"vcznxrlhlrc1Zsfvvcimrxkhlc0g6iff","parameters":{"":"foo","bar":"sdf","sdf":"sd","qqq":"1","we":"g"},"refererUri":"je8uf4yyjMimz4e7dxCgoj6nfGns2Vsvcbdy9pt0wteAbqajBbjqri","timestamp":"2061-01-01T17:07:20.743Z","userId":"f3c9aa1c-d071-47f0-b447-7a9804d58354","useragent":"je8uf4yyjMimz4e7dxCgoj6nfGns2Vsvcbdy9pt0wteAbqajBbjqri","vendor":"p","version":"ymh"}},"processor":{"artifact":"artifact","version":"0.0.1"}}""")
        .right
        .get
      val result = BadRowEncoders.transform(io.circe.parser.parse(input).right.get)
      println(result)
//      result must beEqualTo(expected)
      ok
    }
  }
}
